<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京高専 出前授業分析 Ver.2 - 単語除外テスト版</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style_v2.css') }}" rel="stylesheet">
    <!-- D3.js for Word Tree -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- vis.js for Co-occurrence Network -->
    <link href="https://unpkg.com/vis-network@latest/dist/dist/vis-network.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vis-network@latest/dist/vis-network.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1><i class="fas fa-filter"></i> 東京高専 出前授業分析 Ver.2</h1>
            <p class="subtitle">単語除外テスト版 - アクセシビリティ改善・固定ビジュアルパラメータ</p>
            <div class="version-info">
                <span class="badge">WCAG 2.1 Level AA準拠</span>
                <span class="badge">固定パラメータ版</span>
                <span class="badge">ポート: 5002</span>
            </div>
        </header>

        <!-- タブナビゲーション -->
        <nav class="tab-navigation" role="tablist">
            <button class="tab-button active" role="tab" aria-selected="true" aria-controls="standard-panel" 
                    id="standard-tab" onclick="switchMode('standard')">
                <i class="fas fa-cloud"></i> 通常ワードクラウド
            </button>
            <button class="tab-button" role="tab" aria-selected="false" aria-controls="difference-panel" 
                    id="difference-tab" onclick="switchMode('difference')">
                <i class="fas fa-balance-scale"></i> 差分ワードクラウド
            </button>
            <button class="tab-button" role="tab" aria-selected="false" aria-controls="wordtree-panel" 
                    id="wordtree-tab" onclick="switchMode('wordtree')">
                <i class="fas fa-tree"></i> Word Tree
            </button>
            <button class="tab-button" role="tab" aria-selected="false" aria-controls="cooccurrence-panel" 
                    id="cooccurrence-tab" onclick="switchMode('cooccurrence')">
                <i class="fas fa-project-diagram"></i> 共起ネットワーク
            </button>
        </nav>

        <div class="main-content">
            <!-- 通常モード設定パネル -->
            <div id="standard-panel" class="settings-panel mode-panel" role="tabpanel" aria-labelledby="standard-tab">
                <div class="panel-header">
                    <h2><i class="fas fa-sliders-h"></i> 単語除外設定</h2>
                </div>

                <!-- 固定パラメータ表示 -->
                <div class="fixed-params-info">
                    <h3><i class="fas fa-lock"></i> 固定ビジュアルパラメータ</h3>
                    <div class="param-grid">
                        <div class="param-item">
                            <span class="param-label">最小フォント:</span>
                            <span class="param-value">24px</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">最大フォント:</span>
                            <span class="param-value">174px</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">水平配置率:</span>
                            <span class="param-value">90%</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">相対スケーリング:</span>
                            <span class="param-value">0.4</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">最大単語数:</span>
                            <span class="param-value">140</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">背景色:</span>
                            <span class="param-value">#f8f8f8</span>
                        </div>
                    </div>
                </div>

                <!-- テキストソース選択 -->
                <div class="setting-group">
                    <h3><i class="fas fa-file-alt"></i> データソース</h3>
                    
                    <div class="form-group">
                        <label for="textSource">分析対象:</label>
                        <select id="textSource" class="form-control" aria-label="分析対象のデータを選択">
                            <option value="all_responses">全回答（統合）</option>
                            <option value="comments">感想文のみ</option>
                            <option value="q2_before">授業前（なぜしょっぱい？）</option>
                            <option value="q2_after">授業後（なぜしょっぱい？）</option>
                            <option value="custom">カスタム</option>
                        </select>
                    </div>

                    <div class="form-group" id="customTextGroup" style="display: none;">
                        <label for="customText">カスタムテキスト:</label>
                        <textarea id="customText" class="form-control" rows="4" 
                                  placeholder="ここにテキストを入力してください..."
                                  aria-label="カスタムテキスト入力"></textarea>
                    </div>
                </div>

                <!-- 単語除外設定 -->
                <div class="setting-group">
                    <h3><i class="fas fa-filter"></i> 単語除外設定</h3>
                    
                    <div class="exclude-categories">
                        <h4>除外カテゴリー:</h4>
                        <div class="category-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="excludeGeneral" value="general">
                                <span>一般的な単語（よう、こと、もの等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="excludeThanks" value="thanks">
                                <span>感謝の表現（ありがとう、ございます等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="excludeSchool" value="school">
                                <span>学校関連（東京高専、授業、先生等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="excludeExperiment" value="experiment">
                                <span>実験関連（実験、観察、やり等）</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customExcludeWords">カスタム除外単語（カンマ区切り）:</label>
                        <textarea id="customExcludeWords" class="form-control" rows="3" 
                                  placeholder="例: 塩, ナトリウム, 面白い"
                                  aria-label="カスタム除外単語入力"></textarea>
                    </div>
                </div>

                <!-- フォント・サイズ設定 -->
                <div class="setting-group">
                    <h3><i class="fas fa-text-height"></i> 基本設定</h3>
                    
                    <div class="form-group">
                        <label for="fontSelect">日本語フォント:</label>
                        <select id="fontSelect" class="form-control" aria-label="日本語フォントの選択">
                            <option value="">読み込み中...</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label for="width">幅 (px):</label>
                            <input type="number" id="width" class="form-control" 
                                   min="400" max="2000" value="1000"
                                   aria-label="画像の幅">
                        </div>
                        <div class="form-group half">
                            <label for="height">高さ (px):</label>
                            <input type="number" id="height" class="form-control" 
                                   min="300" max="1500" value="600"
                                   aria-label="画像の高さ">
                        </div>
                    </div>
                </div>

                <!-- カラーマップ設定 -->
                <div class="setting-group">
                    <h3><i class="fas fa-palette"></i> アクセシブルカラー設定</h3>
                    
                    <div class="color-info">
                        <p class="info-text">
                            <i class="fas fa-info-circle"></i>
                            WCAG 2.1 Level AA準拠のカラースキーム
                        </p>
                        <div class="color-samples">
                            <div class="color-sample" style="background-color: #d06500;">
                                <span>オレンジ</span>
                            </div>
                            <div class="color-sample" style="background-color: #0066cc;">
                                <span>ブルー</span>
                            </div>
                            <div class="color-sample" style="background-color: #331a00;">
                                <span>ブラウン</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="colormap">カラーマップ:</label>
                        <select id="colormap" class="form-control" aria-label="カラーマップの選択">
                            <option value="accessible_three">アクセシブル3色</option>
                            <option value="orange_focused">オレンジ中心</option>
                            <option value="blue_focused">ブルー中心</option>
                            <option value="balanced">バランス</option>
                        </select>
                    </div>
                </div>

                <!-- アクションボタン -->
                <div class="action-buttons">
                    <button id="generateBtn" class="btn btn-primary btn-large" 
                            aria-label="ワードクラウドを生成">
                        <i class="fas fa-magic"></i> 生成
                    </button>
                    <button id="exportConfig" class="btn btn-secondary"
                            aria-label="設定をエクスポート">
                        <i class="fas fa-download"></i> 設定エクスポート
                    </button>
                    <button id="resetBtn" class="btn btn-outline"
                            aria-label="設定をリセット">
                        <i class="fas fa-refresh"></i> リセット
                    </button>
                </div>
            </div>

            <!-- 差分モード設定パネル -->
            <div id="difference-panel" class="settings-panel mode-panel" role="tabpanel" aria-labelledby="difference-tab" style="display: none;">
                <div class="panel-header">
                    <h2><i class="fas fa-balance-scale"></i> 差分分析設定</h2>
                </div>

                <!-- 比較データ設定 -->
                <div class="setting-group">
                    <h3><i class="fas fa-layer-group"></i> 比較データ選択</h3>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="baseDataset">基準データ:</label>
                            <select id="baseDataset" class="form-control" aria-label="基準データセットの選択">
                                <option value="q2_before">授業前（なぜしょっぱい？）</option>
                                <option value="comments">感想文のみ</option>
                                <option value="all_responses">全回答（統合）</option>
                            </select>
                        </div>
                        <div class="form-group half">
                            <label for="compareDataset">比較データ:</label>
                            <select id="compareDataset" class="form-control" aria-label="比較データセットの選択">
                                <option value="q2_after">授業後（なぜしょっぱい？）</option>
                                <option value="comments">感想文のみ</option>
                                <option value="all_responses">全回答（統合）</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 差分計算方法 -->
                <div class="setting-group">
                    <h3><i class="fas fa-calculator"></i> 差分計算方法</h3>
                    
                    <div class="form-group">
                        <label for="calculationMethod">計算方式:</label>
                        <select id="calculationMethod" class="form-control" aria-label="差分計算方式の選択">
                            <option value="frequency_difference">頻度差（新出現語を大幅強調）</option>
                            <option value="relative_difference">相対差分（変化率重視）</option>
                            <option value="log_ratio">対数比（統計的安定性）</option>
                        </select>
                        
                        <div class="calculation-method-info">
                            <div class="method-explanation">
                                <h5><i class="fas fa-info-circle"></i> 計算方式の特徴</h5>
                                <div class="method-details">
                                    <div class="method-item" id="freq-diff-info">
                                        <strong>頻度差</strong>: 新出現語（例：ナトリウム）を大きく強調。教育効果が視覚的に明確
                                    </div>
                                    <div class="method-item" id="relative-diff-info">
                                        <strong>相対差分</strong>: 変化率を重視。小さな語の重要な変化も検出
                                    </div>
                                    <div class="method-item" id="log-ratio-info">
                                        <strong>対数比</strong>: 統計的に安定。研究論文レベルの分析に適用
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label for="minOccurrence">最小出現回数:</label>
                            <input type="number" id="minOccurrence" class="form-control" 
                                   min="1" max="10" value="1"
                                   aria-label="最小出現回数">
                        </div>
                        <div class="form-group half">
                            <label for="minDifference">最小差分閾値:</label>
                            <input type="number" id="minDifference" class="form-control" 
                                   min="0.01" max="1" step="0.01" value="0.1"
                                   aria-label="最小差分閾値">
                        </div>
                    </div>
                </div>

                <!-- 科学用語ハイライト -->
                <div class="setting-group">
                    <h3><i class="fas fa-flask"></i> 科学用語強調</h3>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="scienceHighlight" checked>
                            <span>科学用語をハイライト表示</span>
                        </label>
                    </div>

                    <div class="science-terms-info">
                        <div class="term-level">
                            <span class="level-label basic">基礎:</span>
                            <span class="terms">塩, 食塩, 塩分</span>
                        </div>
                        <div class="term-level">
                            <span class="level-label intermediate">中級:</span>
                            <span class="terms">ナトリウム, 塩化ナトリウム</span>
                        </div>
                        <div class="term-level">
                            <span class="level-label advanced">上級:</span>
                            <span class="terms">Na, NaCl, イオン, Na+</span>
                        </div>
                    </div>
                </div>

                <!-- 除外単語設定（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-filter"></i> 除外単語設定</h3>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="diffExcludeGeneral" value="general" checked>
                                <span>一般的単語（みなさん、今日等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="diffExcludeThanks" value="thanks" checked>
                                <span>感謝表現（ありがとう等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="diffExcludeSchool" value="school">
                                <span>学校関連（東京高専、授業等）</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="diffExcludeExperiment" value="experiment">
                                <span>実験関連（実験、観察等）</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="diffCustomExcludeWords">カスタム除外単語（カンマ区切り）:</label>
                        <textarea id="diffCustomExcludeWords" class="form-control" rows="3" 
                                  placeholder="例: 東京, 高専, 面白い"
                                  aria-label="差分分析用カスタム除外単語入力"></textarea>
                    </div>
                </div>

                <!-- 差分カラーマップ -->
                <div class="setting-group">
                    <h3><i class="fas fa-palette"></i> 差分カラーマップ</h3>
                    
                    <div class="difference-color-info">
                        <div class="color-legend">
                            <div class="legend-item">
                                <div class="color-box increase-unified"></div>
                                <span>増加語（新出現・頻度増加）</span>
                            </div>
                            <div class="legend-item">
                                <div class="color-box decrease-unified"></div>
                                <span>減少語（消失・頻度減少）</span>
                            </div>
                            <div class="legend-item">
                                <div class="color-box common-unified"></div>
                                <span>共通語（変化なし）</span>
                            </div>
                            <div class="legend-item">
                                <div class="color-box science-unified"></div>
                                <span>科学用語（特別強調）</span>
                            </div>
                        </div>
                        <div class="unified-colors-note">
                            <i class="fas fa-palette"></i>
                            <span>Ver.2統一カラー: アクセシブル準拠デザイン</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="differenceColormap">差分カラーマップ:</label>
                        <select id="differenceColormap" class="form-control" aria-label="差分カラーマップの選択">
                            <option value="difference_standard">標準差分（7色グラデーション）</option>
                            <option value="science_focused">科学教育特化（4色）</option>
                        </select>
                    </div>
                </div>

                <!-- フォント・サイズ設定（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-text-height"></i> 基本設定</h3>
                    
                    <div class="form-group">
                        <label for="diffFontSelect">日本語フォント:</label>
                        <select id="diffFontSelect" class="form-control" aria-label="差分用日本語フォントの選択">
                            <option value="">読み込み中...</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label for="diffWidth">幅 (px):</label>
                            <input type="number" id="diffWidth" class="form-control" 
                                   min="400" max="2000" value="1200"
                                   aria-label="差分ワードクラウドの幅">
                        </div>
                        <div class="form-group half">
                            <label for="diffHeight">高さ (px):</label>
                            <input type="number" id="diffHeight" class="form-control" 
                                   min="300" max="1500" value="800"
                                   aria-label="差分ワードクラウドの高さ">
                        </div>
                    </div>
                </div>

                <!-- アクションボタン -->
                <div class="action-buttons">
                    <button id="diffGenerateBtn" class="btn btn-primary btn-large" 
                            aria-label="差分ワードクラウドを生成">
                        <i class="fas fa-balance-scale"></i> 差分分析実行
                    </button>
                    <button id="diffExportConfig" class="btn btn-secondary"
                            aria-label="差分設定をエクスポート">
                        <i class="fas fa-download"></i> 設定エクスポート
                    </button>
                    <button id="diffResetBtn" class="btn btn-outline"
                            aria-label="差分設定をリセット">
                        <i class="fas fa-refresh"></i> リセット
                    </button>
                </div>
            </div>

            <!-- プレビューエリア -->
            <div class="preview-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-eye"></i> プレビュー</h2>
                    <div class="preview-controls">
                        <button id="downloadImage" class="btn btn-secondary" 
                                title="画像ダウンロード" style="display: none;"
                                aria-label="画像をダウンロード">
                            <i class="fas fa-download"></i> ダウンロード
                        </button>
                    </div>
                </div>

                <div class="preview-container">
                    <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ワードクラウドを生成中...</p>
                    </div>
                    
                    <div id="errorMessage" class="error-message" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p id="errorText">エラーが発生しました</p>
                    </div>
                    
                    <div id="previewImage" class="preview-image" style="display: none;">
                        <img id="wordcloudImg" alt="生成されたワードクラウド">
                    </div>
                    
                    <div id="wordTreeContainer" class="visualization-container" style="display: none;">
                        <!-- D3.jsでWord Treeを描画 -->
                    </div>
                    
                    <div id="cooccurrenceContainer" class="visualization-container" style="display: none;">
                        <!-- vis.jsで共起ネットワークを描画 -->
                    </div>
                    
                    <div id="welcomeMessage" class="welcome-message">
                        <i class="fas fa-filter fa-3x"></i>
                        <h3>単語除外テスト版</h3>
                        <p>除外したい単語を選択して、より意味のあるワードクラウドを生成します</p>
                        <div class="feature-list">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>固定ビジュアルパラメータで一貫性のある結果</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>WCAG 2.1準拠のアクセシブルカラー</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>カテゴリー別の単語除外機能</span>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-large" onclick="generateWordCloud()" 
                                aria-label="分析を開始">
                            <i class="fas fa-magic"></i> 分析を開始
                        </button>
                    </div>
                </div>

                <!-- メタ情報 -->
                <div id="metaInfo" class="meta-info" style="display: none;">
                    <div class="meta-row">
                        <span class="meta-label">フォント:</span>
                        <span id="metaFont">-</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">サイズ:</span>
                        <span id="metaSize">-</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">カラーマップ:</span>
                        <span id="metaColormap">-</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-label">除外カテゴリー:</span>
                        <span id="metaExcluded">-</span>
                    </div>
                </div>

                <!-- 差分統計情報パネル -->
                <div id="statisticsInfo" class="statistics-info" style="display: none;">
                    <div class="stats-header">
                        <h3><i class="fas fa-chart-bar"></i> 差分分析結果</h3>
                    </div>

                    <div class="stats-grid">
                        <!-- 基本統計 -->
                        <div class="stats-section">
                            <h4><i class="fas fa-info-circle"></i> 基本統計</h4>
                            <div class="stats-row">
                                <span class="stats-label">総語彙数変化:</span>
                                <span id="statsTotalWords">-</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">固有語彙数変化:</span>
                                <span id="statsUniqueWords">-</span>
                            </div>
                        </div>

                        <!-- 語彙変化 -->
                        <div class="stats-section">
                            <h4><i class="fas fa-arrow-up"></i> 語彙変化</h4>
                            <div class="stats-row">
                                <span class="stats-label">新出現語数:</span>
                                <span id="statsNewWords" class="increase">-</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">消失語数:</span>
                                <span id="statsLostWords" class="decrease">-</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">増加語数:</span>
                                <span id="statsIncreasedWords" class="increase">-</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">減少語数:</span>
                                <span id="statsDecreasedWords" class="decrease">-</span>
                            </div>
                        </div>

                        <!-- 科学用語変化 -->
                        <div class="stats-section">
                            <h4><i class="fas fa-flask"></i> 科学用語変化</h4>
                            <div id="scienceTermsStats">
                                <!-- JavaScriptで動的に追加 -->
                            </div>
                        </div>
                    </div>

                    <!-- TOP変化語 -->
                    <div class="top-changes">
                        <div class="top-section">
                            <h4><i class="fas fa-plus"></i> TOP5 新出現語</h4>
                            <div id="topNewWords" class="word-list">
                                <!-- JavaScriptで動的に追加 -->
                            </div>
                        </div>
                        <div class="top-section">
                            <h4><i class="fas fa-minus"></i> TOP5 消失語</h4>
                            <div id="topLostWords" class="word-list">
                                <!-- JavaScriptで動的に追加 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Word Treeパネル -->
            <div id="wordtree-panel" class="settings-panel mode-panel" role="tabpanel" aria-labelledby="wordtree-tab" style="display: none;">
                <div class="panel-header">
                    <h2><i class="fas fa-tree"></i> Word Tree設定</h2>
                    <p>特定の単語から始まる文脈を階層的に可視化します</p>
                </div>

                <!-- データソース選択（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-database"></i> データソース</h3>
                    
                    <div class="form-group">
                        <label for="wordtreeTextSource">分析対象:</label>
                        <select id="wordtreeTextSource" class="form-control" aria-label="Word Tree用データソース">
                            <option value="all_responses">全回答（統合）</option>
                            <option value="comments">感想文のみ</option>
                            <option value="q2_before">授業前（なぜしょっぱい？）</option>
                            <option value="q2_after">授業後（なぜしょっぱい？）</option>
                            <option value="custom">カスタム</option>
                        </select>
                    </div>

                    <div class="form-group" id="wordtreeCustomTextGroup" style="display: none;">
                        <label for="wordtreeCustomText">カスタムテキスト:</label>
                        <textarea id="wordtreeCustomText" class="form-control" rows="4" 
                                  placeholder="分析するテキストを入力..."
                                  aria-label="Word Tree用カスタムテキスト"></textarea>
                    </div>
                </div>

                <!-- ルート語選択 -->
                <div class="setting-group">
                    <h3><i class="fas fa-anchor"></i> ルート語設定</h3>
                    
                    <div class="form-group">
                        <label for="wordtreeAutoRoots">
                            <input type="checkbox" id="wordtreeAutoRoots" checked aria-label="推奨ルート語を自動選択">
                            推奨ルート語を自動選択
                        </label>
                    </div>

                    <div id="recommendedRootsInfo" class="info-box">
                        <h4>推奨ルート語カテゴリー:</h4>
                        <div class="root-categories">
                            <div class="root-category">
                                <strong>科学用語:</strong> 塩、ナトリウム、塩化ナトリウム
                            </div>
                            <div class="root-category">
                                <strong>実験関連:</strong> 炎色反応、結晶、実験
                            </div>
                            <div class="root-category">
                                <strong>感情表現:</strong> 楽しかった、わかった、面白い、すごい
                            </div>
                            <div class="root-category">
                                <strong>行動動詞:</strong> 見る、観察、やる、知る
                            </div>
                        </div>
                    </div>

                    <div class="form-group" id="customRootsGroup" style="display: none;">
                        <label for="wordtreeCustomRoots">カスタムルート語 (カンマ区切り):</label>
                        <input type="text" id="wordtreeCustomRoots" class="form-control" 
                               placeholder="例: 塩, 実験, 楽しい"
                               aria-label="カスタムルート語">
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label for="wordtreeMaxRoots">最大ルート語数:</label>
                            <input type="number" id="wordtreeMaxRoots" class="form-control" 
                                   min="1" max="5" value="3"
                                   aria-label="最大ルート語数">
                        </div>
                        <div class="form-group half">
                            <label for="wordtreeDepth">ツリーの深さ:</label>
                            <input type="number" id="wordtreeDepth" class="form-control" 
                                   min="1" max="5" value="3"
                                   aria-label="ツリーの深さ">
                        </div>
                    </div>
                </div>

                <!-- 単語除外設定（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-filter"></i> 単語除外設定</h3>
                    
                    <div class="exclude-categories" id="wordtreeExcludeCategories">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                    
                    <div class="form-group">
                        <label for="wordtreeCustomExclude">カスタム除外単語 (カンマ区切り):</label>
                        <input type="text" id="wordtreeCustomExclude" class="form-control" 
                               placeholder="例: です, ます, こと"
                               aria-label="Word Tree用カスタム除外単語">
                    </div>
                </div>

                <!-- アクションボタン -->
                <div class="action-buttons">
                    <button id="wordtreeGenerateBtn" class="btn btn-primary btn-large" 
                            aria-label="Word Treeを生成">
                        <i class="fas fa-tree"></i> Word Tree生成
                    </button>
                    <button id="wordtreeResetBtn" class="btn btn-outline"
                            aria-label="Word Tree設定をリセット">
                        <i class="fas fa-refresh"></i> リセット
                    </button>
                </div>
            </div>

            <!-- 共起ネットワークパネル -->
            <div id="cooccurrence-panel" class="settings-panel mode-panel" role="tabpanel" aria-labelledby="cooccurrence-tab" style="display: none;">
                <div class="panel-header">
                    <h2><i class="fas fa-project-diagram"></i> 共起ネットワーク設定</h2>
                    <p>単語間の共起関係をネットワーク図で可視化します</p>
                </div>

                <!-- データソース選択（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-database"></i> データソース</h3>
                    
                    <div class="form-group">
                        <label for="coocTextSource">分析対象:</label>
                        <select id="coocTextSource" class="form-control" aria-label="共起ネットワーク用データソース">
                            <option value="all_responses">全回答（統合）</option>
                            <option value="comments">感想文のみ</option>
                            <option value="q2_before">授業前（なぜしょっぱい？）</option>
                            <option value="q2_after">授業後（なぜしょっぱい？）</option>
                            <option value="custom">カスタム</option>
                        </select>
                    </div>

                    <div class="form-group" id="coocCustomTextGroup" style="display: none;">
                        <label for="coocCustomText">カスタムテキスト:</label>
                        <textarea id="coocCustomText" class="form-control" rows="4" 
                                  placeholder="分析するテキストを入力..."
                                  aria-label="共起ネットワーク用カスタムテキスト"></textarea>
                    </div>
                </div>

                <!-- 共起設定 -->
                <div class="setting-group">
                    <h3><i class="fas fa-cogs"></i> 共起分析設定</h3>
                    
                    <div class="form-group">
                        <label for="coocWindowSize">共起ウィンドウサイズ:</label>
                        <div class="slider-container">
                            <input type="range" id="coocWindowSize" class="form-range" 
                                   min="0" max="10" value="0"
                                   aria-label="共起ウィンドウサイズ">
                            <span id="coocWindowSizeValue" class="slider-value">文内共起</span>
                        </div>
                        <small class="form-text">0: 文内共起 / 1-10: 前後N語での共起</small>
                    </div>

                    <div class="form-group">
                        <label for="coocAssociationMethod">関連度計算方法:</label>
                        <select id="coocAssociationMethod" class="form-control" aria-label="関連度計算方法">
                            <option value="pmi">PMI (相互情報量)</option>
                            <option value="jaccard">Jaccard係数</option>
                            <option value="frequency">共起頻度</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label for="coocMinEdgeWeight">最小エッジ重み:</label>
                            <input type="number" id="coocMinEdgeWeight" class="form-control" 
                                   min="1" max="10" value="2"
                                   aria-label="最小エッジ重み">
                        </div>
                        <div class="form-group half">
                            <label for="coocMinNodeFreq">最小ノード頻度:</label>
                            <input type="number" id="coocMinNodeFreq" class="form-control" 
                                   min="1" max="10" value="3"
                                   aria-label="最小ノード頻度">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="coocMaxNodes">最大ノード数:</label>
                        <div class="slider-container">
                            <input type="range" id="coocMaxNodes" class="form-range" 
                                   min="10" max="100" value="50" step="10"
                                   aria-label="最大ノード数">
                            <span id="coocMaxNodesValue" class="slider-value">50</span>
                        </div>
                    </div>
                </div>

                <!-- 単語除外設定（共通） -->
                <div class="setting-group">
                    <h3><i class="fas fa-filter"></i> 単語除外設定</h3>
                    
                    <div class="exclude-categories" id="coocExcludeCategories">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                    
                    <div class="form-group">
                        <label for="coocCustomExclude">カスタム除外単語 (カンマ区切り):</label>
                        <input type="text" id="coocCustomExclude" class="form-control" 
                               placeholder="例: です, ます, こと"
                               aria-label="共起ネットワーク用カスタム除外単語">
                    </div>
                </div>

                <!-- アクションボタン -->
                <div class="action-buttons">
                    <button id="coocGenerateBtn" class="btn btn-primary btn-large" 
                            aria-label="共起ネットワークを生成">
                        <i class="fas fa-project-diagram"></i> ネットワーク生成
                    </button>
                    <button id="coocResetBtn" class="btn btn-outline"
                            aria-label="共起ネットワーク設定をリセット">
                        <i class="fas fa-refresh"></i> リセット
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast通知 -->
    <div id="toast" class="toast" role="alert" aria-live="polite">
        <div class="toast-content">
            <i class="toast-icon"></i>
            <span class="toast-message"></span>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app_v2.js') }}"></script>
</body>
</html>